<div class="container">
  <mat-toolbar class="toolbar">
    <span>Detalle de plantilla Excel</span>
    <div class="button-spacer"></div>
    <button mat-button (click)="back()">
      <mat-icon> arrow_back </mat-icon>Regresar
    </button>
  </mat-toolbar>
  <mat-spinner
    *ngIf="loading"
    diameter="50"
    class="spinner"
    style="margin-top: 200px"
  ></mat-spinner>
  <div class="form-controls" *ngIf="!loading">
    <button
      mat-raised-button
      type="button"
      color="primary"
      style="margin-right: 20px"
      (click)="generarPlantilla()"
      *ngIf="idPlantillaComprobante === '0'"
    >
      <mat-icon>playlist_add_check</mat-icon>Generar plantilla
    </button>
    <button
      mat-raised-button
      type="button"
      color="success"
      style="margin-right: 20px"
      (click)="descargarPlantilla()"
      *ngIf="idPlantillaComprobante !== '0'"
    >
      <mat-icon> file_download</mat-icon>Descargar plantilla
    </button>
    <button
      mat-raised-button
      type=""
      color="primary"
      style="margin-right: 20px"
      *ngIf="idPlantillaComprobante !== '0'"
      [disabled]="readonlyOption"
      (click)="agregarPlantillaComprobante()"
    >
      Guardar
    </button>
    <button
      mat-raised-button
      type="button"
      color="warn"
      [disabled]="eliminar"
      (click)="eliminarPlantillaComprobante(idPlantillaComprobante)"
      *ngIf="idPlantillaComprobante !== '0'"
    >
      Eliminar
    </button>
    <div *ngIf="listaDetallePlantillaComprobante.length > 0">
      <div style="margin-top: 24px">
        <form [formGroup]="form">
          <mat-grid-list
            cols="6"
            rowHeight="70px"
            *ngIf="idPlantillaComprobante !== '0'"
          >
            <mat-grid-tile
              [colspan]="1"
              [rowspan]="1"
              [style.background]="'transparent'"
            >
              <mat-form-field class="input-option input-option-right">
                <mat-label>Id Plantilla</mat-label>
                <input
                  matInput
                  autocomplete="off"
                  readonly
                  formControlName="idPlantillaComprobante"
                />
              </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile [colspan]="1" [rowspan]="1">
              <mat-form-field class="input-option">
                <mat-label>N° Ticket</mat-label>
                <input
                  matInput
                  autocomplete="off"
                  [disabled]="readonlyOption"
                  formControlName="nroTicketEnvio"
                />
              </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile [colspan]="1" [rowspan]="1">
              <mat-form-field class="input-option">
                <mat-label>Fecha declaración</mat-label>
                <input
                  matInput
                  [matDatepicker]="picker"
                  [readonly]="readonlyOption"
                  formControlName="fechaDeclaracion"
                />
                <mat-hint>DD/MM/YYYY</mat-hint>
                <mat-datepicker-toggle
                  matSuffix
                  [for]="picker"
                ></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile [colspan]="3" [rowspan]="1"> </mat-grid-tile>
            <mat-grid-tile [colspan]="6" [rowspan]="1">
              <div class="input-option">
                <mat-form-field>
                  <mat-label>Observación</mat-label>
                  <input
                    matInput
                    [disabled]="readonlyOption"
                    autocomplete="off"
                    formControlName="observacion"
                  />
                </mat-form-field>
              </div>
            </mat-grid-tile>
          </mat-grid-list>
        </form>
      </div>
      <table mat-table [dataSource]="dataSource" matSort>
        <ng-container matColumnDef="select">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="border-radius: 20px 0 0 20px"
          >
            <mat-checkbox
              (change)="$event ? masterToggle() : null"
              [checked]="selection.hasValue() && isAllSelected()"
              [indeterminate]="selection.hasValue() && !isAllSelected()"
              [disabled]="idPlantillaComprobante !== '0'"
            >
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox
              (click)="
                $event.stopPropagation();
                selectRow(element.serie, element.correlativo)
              "
              (change)="$event ? selection.toggle(element) : null"
              [checked]="selection.isSelected(element)"
              [disabled]="idPlantillaComprobante !== '0'"
            >
            </mat-checkbox>
          </td>
        </ng-container>

        <!-- idPlantillaComprobante Column -->
        <ng-container matColumnDef="idPlantillaComprobante">
          <th
            mat-header-cell
            *matHeaderCellDef
            mat-sort-header
            style="display: none"
          >
            idPlantillaComprobante
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
            style="display: none"
          >
            {{ element.idPlantillaComprobante }}
          </td>
        </ng-container>

        <!-- serie Column -->
        <ng-container matColumnDef="serie">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center"
          >
            Serie
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.serie }}
          </td>
        </ng-container>

        <!-- correlativo Column -->
        <ng-container matColumnDef="correlativo">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center"
          >
            Correlativo
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.correlativo }}
          </td>
        </ng-container>

        <!-- nroDocumento Column -->
        <ng-container matColumnDef="nroDocumento">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center"
          >
            Doc. Proveedor
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.nroDocumento }}
          </td>
        </ng-container>

        <!-- razonSocial Column -->
        <ng-container matColumnDef="razonSocial">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center"
          >
            Proveedor
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.razonSocial }}
          </td>
        </ng-container>

        <!-- fechaEmision Column -->
        <ng-container matColumnDef="fechaEmision">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center"
          >
            F. Emisión
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.fechaEmision }}
          </td>
        </ng-container>

        <!-- formaPago Column -->
        <ng-container matColumnDef="formaPago">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center"
          >
            F. Pago
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.desFormaPago }}
          </td>
        </ng-container>

        <!-- importeTotal Column -->
        <ng-container matColumnDef="importeTotal">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center"
          >
            Importe
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.importeTotal }}
          </td>
        </ng-container>

        <!-- Estado Column -->
        <ng-container matColumnDef="estado">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="header-table"
            style="text-align: center; border-radius: 0 20px 20px 0"
          >
            Estado
          </th>
          <td
            mat-cell
            *matCellDef="let element"
            [ngClass]="element.estado === 'A' ? 'rowActive' : 'rowInactive'"
          >
            {{ element.desEstado }}
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <mat-paginator
        [pageSizeOptions]="[5, 10, 25, 100]"
        showFirstLastButtons
        aria-label="Seleccionar página"
      ></mat-paginator>
    </div>
    <div
      *ngIf="listaDetallePlantillaComprobante.length === 0"
      class="empty-list"
    >
      <h2>No hay comprobantes asociados para mostrar</h2>
    </div>
  </div>
</div>
